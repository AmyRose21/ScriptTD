
-- Obtener referencias al jugador, su personaje, humanoide y la parte raÃ­z
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")
local textChatService = game:GetService("TextChatService")

--------------------------------------------------------------------------------
-- ConfiguraciÃ³n GUI y creaciÃ³n del botÃ³n de habilidad
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))

local hoverButton = Instance.new("ImageButton")
hoverButton.Size = UDim2.new(0, 80, 0, 80)
hoverButton.Position = UDim2.new(0.5, -40, 0.9, 0)
hoverButton.BackgroundTransparency = 1
hoverButton.Image = "rbxassetid://127738269107159"
hoverButton.Parent = screenGui

-- BotÃ³n circular
local uiCorner = Instance.new("UICorner", hoverButton)
uiCorner.CornerRadius = UDim.new(1, 0)

hoverButton.Draggable = true
hoverButton.Selectable = true
hoverButton.Active = true

--------------------------------------------------------------------------------
-- AnimaciÃ³n para indicar modo impulso activo
local hoverAnimation = Instance.new("Animation")
hoverAnimation.AnimationId = "rbxassetid://17172142074"
local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
local hoverTrack = animator:LoadAnimation(hoverAnimation)

--------------------------------------------------------------------------------
-- Sonido para la habilidad
local hoverSound = Instance.new("Sound")
hoverSound.SoundId = "rbxassetid://4454997815"
hoverSound.Looped = true
hoverSound.Volume = 2
hoverSound.Parent = workspace

--------------------------------------------------------------------------------
-- ParÃ¡metros del impulso vertical y duraciÃ³n mÃ¡xima del modo impulso
local boostWindow = 5 -- DuraciÃ³n mÃ¡xima en segundos durante la cual se permite el impulso
local boostPower = 50 -- Potencia del impulso hacia arriba

-- Variables internas para controlar estado de la habilidad:
local isBoostingActive = false -- Indica si estÃ¡ activa la "ventana" de impulso
local boostBV = nil            -- BodyVelocity actual (para empuje vertical)
local boostEndTime = 0         -- Momento en que finalizarÃ¡ automÃ¡ticamente la ventana de impulso

-- CAMBIO: Definimos las variables y lÃ³gica del enfriamiento
local cooldown = 30    -- Tiempo de enfriamiento en segundos
local isOnCooldown = false -- Bandera para saber si la habilidad estÃ¡ en recarga

--------------------------------------------------------------------------------
-- FunciÃ³n para iniciar o reanudar el empuje hacia arriba mientras se mantenga
-- presionado el botÃ³n
local function applyBoost()
    if not isBoostingActive then return end -- Solo aplica si la ventana estÃ¡ activa

    if not boostBV then 
        boostBV = Instance.new("BodyVelocity")
        boostBV.Velocity = Vector3.new(0, boostPower, 0)
        boostBV.MaxForce = Vector3.new(0, 10000, 0)
        boostBV.Parent = rootPart
    end
end

-- FunciÃ³n para detener temporalmente el empuje (al soltar botÃ³n)
local function stopApplyingBoost()
    if boostBV then 
        boostBV:Destroy()
        boostBV = nil 
    end
end

--------------------------------------------------------------------------------
-- FunciÃ³n que inicia la ventana de tiempo de la habilidad
local function startBoostMode()
    -- CAMBIO: Comprobamos si estÃ¡ en cooldown
    if isOnCooldown then
        -- AquÃ­ podrÃ­amos mostrar un mensaje en pantalla o un print
        print("Habilidad en enfriamiento. Intenta mÃ¡s tarde.")
        return
    end

    if isBoostingActive then return end

    isBoostingActive = true

    -- Inicia animaciÃ³n y sonido una sola vez por ventana activa
    hoverTrack:Play()
    hoverSound:Play()

    -- Mensaje aleatorio al chat al activar habilidad
    local mensajesPosibles = {"ğŸ’§â˜ŸâœŒğŸ‘âšğŸ•ˆğŸ“‚", "ğŸ’§â˜ŸâœŒğŸ‘âšğŸ•ˆğŸ“„", "ğŸ’§â˜ŸâœŒğŸ‘âšğŸ•ˆğŸ—"}
    local mensajeAleatorio = mensajesPosibles[math.random(#mensajesPosibles)]
    local rbxGeneralChannel = textChatService.TextChannels:WaitForChild("RBXGeneral")
    rbxGeneralChannel:SendAsync(mensajeAleatorio)

    -- Establece cuÃ¡ndo terminarÃ¡ automÃ¡ticamente la ventana de impulso
    boostEndTime = tick() + boostWindow

    -- Finaliza automÃ¡ticamente tras boostWindow segundos
    delay(boostWindow, function()
        if isBoostingActive then 
            endBoostMode() 
        end 
    end)
end

--------------------------------------------------------------------------------
-- FunciÃ³n que finaliza completamente la ventana de tiempo de la habilidad
function endBoostMode()
    if not isBoostingActive then return end

    isBoostingActive = false

    stopApplyingBoost() -- Asegura eliminar cualquier empuje restante

    if hoverTrack.IsPlaying then hoverTrack:Stop() end
    if hoverSound.IsPlaying then hoverSound:Stop() end
	local mensajesPosibles = { "â˜âœ‹â˜ âœ‹ğŸ’§â˜ŸğŸ“‚", "â˜âœ‹â˜ âœ‹ğŸ’§â˜ŸğŸ“„", "â˜âœ‹â˜ âœ‹ğŸ’§â˜ŸğŸ—" }
    local mensajeAleatorio = mensajesPosibles[math.random(1, #mensajesPosibles)]

    local rbxGeneralChannel = textChatService:WaitForChild("TextChannels"):WaitForChild("RBXGeneral")
    rbxGeneralChannel:SendAsync(mensajeAleatorio)
    -- CAMBIO: Iniciamos el cooldown al terminar la habilidad
    if not isOnCooldown then
        isOnCooldown = true
        print("Habilidad en recarga de " .. cooldown .. " segundos.")

        delay(cooldown, function()
            isOnCooldown = false
            print("Habilidad lista para usarse nuevamente.")
        end)
    end
end

--------------------------------------------------------------------------------
-- Eventos del botÃ³n

-- Al presionar botÃ³n inicia/reanuda empuje hacia arriba
hoverButton.MouseButton1Down:Connect(function()
    -- Si no estÃ¡ activa la ventana, la iniciamos
    if not isBoostingActive then
        startBoostMode()
    end

    -- Aplica empuje inmediatamente al presionar (si la ventana estÃ¡ activa)
    applyBoost()
end)

-- Al soltar botÃ³n detiene temporalmente empuje (pero no termina la ventana)
hoverButton.MouseButton1Up:Connect(function()
    stopApplyingBoost()
end)

--------------------------------------------------------------------------------
-- Termina automÃ¡ticamente al tocar suelo o morir/reiniciar personaje
humanoid.StateChanged:Connect(function(oldState, newState)
    if newState == Enum.HumanoidStateType.Landed 
        or newState == Enum.HumanoidStateType.Dead 
        or newState == Enum.HumanoidStateType.GettingUp then

        endBoostMode()
    end
end)
